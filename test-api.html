<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Teste da API - Gerenciador de Usu√°rios</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
  </head>
  <body>
    <div class="container mt-5">
      <div class="row justify-content-center">
        <div class="col-md-8">
          <div class="card">
            <div class="card-header bg-primary text-white">
              <h5 class="mb-0">üß™ Teste de Conectividade da API</h5>
            </div>
            <div class="card-body">
              <div class="mb-3">
                <label for="apiUrl" class="form-label">URL da API:</label>
                <input
                  type="url"
                  class="form-control"
                  id="apiUrl"
                  placeholder="https://sua-api.mockapi.io/api/v1/users"
                />
              </div>

              <div class="d-grid gap-2">
                <button class="btn btn-primary" onclick="testConnection()">
                  <i class="bi bi-wifi"></i> Testar Conex√£o
                </button>
                <button class="btn btn-success" onclick="testCreateUser()">
                  <i class="bi bi-plus"></i> Testar Cria√ß√£o de Usu√°rio
                </button>
                <button class="btn btn-info" onclick="testGetUsers()">
                  <i class="bi bi-list"></i> Testar Listagem de Usu√°rios
                </button>
              </div>

              <div id="results" class="mt-4"></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      // Carregar URL da configura√ß√£o se dispon√≠vel
      document.addEventListener("DOMContentLoaded", function () {
        const savedUrl = localStorage.getItem("api_url")
        if (savedUrl) {
          document.getElementById("apiUrl").value = savedUrl
        }
      })

      function getApiUrl() {
        const url = document.getElementById("apiUrl").value.trim()
        if (!url) {
          showResult("‚ö†Ô∏è Por favor, insira a URL da API", "warning")
          return null
        }
        localStorage.setItem("api_url", url)
        return url
      }

      function showResult(message, type = "info") {
        const alertClass =
          type === "success"
            ? "alert-success"
            : type === "error"
            ? "alert-danger"
            : type === "warning"
            ? "alert-warning"
            : "alert-info"

        document.getElementById("results").innerHTML = `
                <div class="alert ${alertClass}" role="alert">
                    ${message}
                </div>
            `
      }

      async function testConnection() {
        const apiUrl = getApiUrl()
        if (!apiUrl) return

        showResult("üîÑ Testando conex√£o...", "info")

        try {
          const response = await fetch(apiUrl)

          if (response.ok) {
            const data = await response.json()
            showResult(
              `
                        ‚úÖ <strong>Conex√£o bem-sucedida!</strong><br>
                        Status: ${response.status}<br>
                        Usu√°rios encontrados: ${
                          Array.isArray(data) ? data.length : "N/A"
                        }<br>
                        URL: ${apiUrl}
                    `,
              "success"
            )
          } else {
            showResult(
              `
                        ‚ùå <strong>Erro na conex√£o</strong><br>
                        Status: ${response.status}<br>
                        Mensagem: ${response.statusText}
                    `,
              "error"
            )
          }
        } catch (error) {
          showResult(
            `
                    ‚ùå <strong>Erro de rede</strong><br>
                    Erro: ${error.message}<br>
                    <small>Verifique se a URL est√° correta e se h√° conex√£o com a internet.</small>
                `,
            "error"
          )
        }
      }

      async function testCreateUser() {
        const apiUrl = getApiUrl()
        if (!apiUrl) return

        showResult("üîÑ Testando cria√ß√£o de usu√°rio...", "info")

        const testUser = {
          nome: "Usu√°rio Teste",
          email: "teste@exemplo.com",
          cargo: "Desenvolvedor Frontend",
          status: "ativo",
        }

        try {
          const response = await fetch(apiUrl, {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify(testUser),
          })

          if (response.ok) {
            const data = await response.json()
            showResult(
              `
                        ‚úÖ <strong>Usu√°rio criado com sucesso!</strong><br>
                        ID: ${data.id}<br>
                        Nome: ${data.nome}<br>
                        Email: ${data.email}<br>
                        Cargo: ${data.cargo}<br>
                        Status: ${data.status}
                    `,
              "success"
            )
          } else {
            showResult(
              `
                        ‚ùå <strong>Erro ao criar usu√°rio</strong><br>
                        Status: ${response.status}<br>
                        Mensagem: ${response.statusText}
                    `,
              "error"
            )
          }
        } catch (error) {
          showResult(
            `
                    ‚ùå <strong>Erro de rede</strong><br>
                    Erro: ${error.message}
                `,
            "error"
          )
        }
      }

      async function testGetUsers() {
        const apiUrl = getApiUrl()
        if (!apiUrl) return

        showResult("üîÑ Testando listagem de usu√°rios...", "info")

        try {
          const response = await fetch(apiUrl)

          if (response.ok) {
            const users = await response.json()

            if (Array.isArray(users) && users.length > 0) {
              const usersList = users
                .slice(0, 3)
                .map(
                  (user) => `
                            <li><strong>${user.nome}</strong> - ${user.email} (${user.cargo})</li>
                        `
                )
                .join("")

              showResult(
                `
                            ‚úÖ <strong>Usu√°rios carregados com sucesso!</strong><br>
                            Total: ${users.length} usu√°rios<br>
                            <br><strong>Primeiros usu√°rios:</strong>
                            <ul>${usersList}</ul>
                        `,
                "success"
              )
            } else {
              showResult(
                `
                            ‚ö†Ô∏è <strong>API funcionando, mas sem usu√°rios</strong><br>
                            A conex√£o est√° OK, mas n√£o h√° usu√°rios cadastrados.<br>
                            Crie alguns usu√°rios de teste no MockAPI.io
                        `,
                "warning"
              )
            }
          } else {
            showResult(
              `
                        ‚ùå <strong>Erro ao carregar usu√°rios</strong><br>
                        Status: ${response.status}<br>
                        Mensagem: ${response.statusText}
                    `,
              "error"
            )
          }
        } catch (error) {
          showResult(
            `
                    ‚ùå <strong>Erro de rede</strong><br>
                    Erro: ${error.message}
                `,
            "error"
          )
        }
      }
    </script>
  </body>
</html>
